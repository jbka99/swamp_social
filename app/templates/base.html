<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Swamp | {% block title %}{% endblock %}</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  >
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
</head>

<body class="swamp theme-light">

  <nav class="navbar navbar-light bg-black">
    <div class="container-fluid justify-content-center px-3 px-lg-4">
      <a class="navbar-brand fw-bold m-0" href="{{ url_for('routes.threads') }}">SWAMP</a>
    </div>
  </nav>

  {% set is_auth_page = request.endpoint in ['routes.login', 'routes.register'] if request.endpoint else False %}

  <main class="container-fluid py-3 py-lg-4 px-3 px-lg-4">
    {% if not is_auth_page %}
      {% set path_str = request.path|default('')|string %}
      {% set path_parts = path_str.strip('/').split('/') if path_str else [] %}
      {% set path_parts = path_parts if path_parts|length > 0 and path_parts[0] != '' else [] %}
      {% set endpoint_name = (request.endpoint|default(''))|string %}
      {% set show_breadcrumbs = (path_parts|length > 0 and path_parts[0] != 'feed') or endpoint_name == 'routes.index' %}
      {% if show_breadcrumbs %}
      <div class="layout-3col">
        <nav class="breadcrumbs col-main" aria-label="Breadcrumb" style="grid-column: 1 / -1;">
          {% if breadcrumbs is defined and breadcrumbs %}
            <a href="{{ url_for('routes.feed') }}" class="breadcrumbs__item">Главная</a>
            <span class="breadcrumbs__separator">/</span>
            {% for item in breadcrumbs %}
              {% if not loop.last %}
                {% if item.url %}
                  <a href="{{ item.url }}" class="breadcrumbs__item">{{ item.label }}</a>
                {% else %}
                  <span class="breadcrumbs__item">{{ item.label }}</span>
                {% endif %}
                <span class="breadcrumbs__separator">/</span>
              {% else %}
                <span class="breadcrumbs__item breadcrumbs__item--active">{{ item.label }}</span>
              {% endif %}
            {% endfor %}
          {% else %}
            {# Default breadcrumbs based on request.path #}
            <a href="{{ url_for('routes.feed') }}" class="breadcrumbs__item">Главная</a>
            {% if endpoint_name == 'routes.index' %}
              <span class="breadcrumbs__separator">/</span>
              <span class="breadcrumbs__item breadcrumbs__item--active">Мой профиль</span>
            {% elif path_parts|length > 0 and path_parts[0] == 'threads' %}
              <span class="breadcrumbs__separator">/</span>
              <span class="breadcrumbs__item breadcrumbs__item--active">Треды</span>
            {% elif path_parts|length > 1 and path_parts[0] == 'user' %}
              <span class="breadcrumbs__separator">/</span>
              {% set username = path_parts[1] if path_parts|length > 1 else '' %}
              {% set user_authenticated = current_user.is_authenticated|default(false) %}
              {% set current_username = '' %}
              {% if user_authenticated %}
                {% set current_username = current_user.username|default('') %}
              {% endif %}
              {% if username and user_authenticated and current_username == username %}
                <span class="breadcrumbs__item breadcrumbs__item--active">Мой профиль</span>
              {% else %}
                <span class="breadcrumbs__separator">/</span>
                <span class="breadcrumbs__item">Профиль</span>
                {% if username %}
                  <span class="breadcrumbs__separator">/</span>
                  <span class="breadcrumbs__item breadcrumbs__item--active">{{ username }}</span>
                {% endif %}
              {% endif %}
            {% elif path_parts|length > 0 and path_parts[0] == 'admin' %}
              <span class="breadcrumbs__separator">/</span>
              <span class="breadcrumbs__item breadcrumbs__item--active">Админка</span>
            {% elif path_parts|length > 1 and path_parts[0] == 'thread' %}
              <span class="breadcrumbs__separator">/</span>
              <a href="{{ url_for('routes.threads') }}" class="breadcrumbs__item">Треды</a>
              <span class="breadcrumbs__separator">/</span>
              {% if thread is defined and thread and thread.title %}
                <span class="breadcrumbs__item breadcrumbs__item--active">{{ thread.title[:50] }}{% if thread.title|length > 50 %}...{% endif %}</span>
              {% else %}
                <span class="breadcrumbs__item breadcrumbs__item--active">Тред</span>
              {% endif %}
            {% elif path_parts|length > 0 and path_parts[0] == 'settings' %}
              <span class="breadcrumbs__separator">/</span>
              <span class="breadcrumbs__item breadcrumbs__item--active">Настройки</span>
            {% endif %}
          {% endif %}
        </nav>
      </div>
      {% endif %}
    {% endif %}
    
    {% with messages = get_flashed_messages(with_categories=True) %}
      {% if messages %}
        {% if is_auth_page %}
          <div class="layout-shell mb-3">
        {% else %}
          <div class="layout-3col mb-3">
            <div class="col-main" style="grid-column: 1 / -1;">
        {% endif %}
            {% for category, message in messages %}
              {% set bs = 'info' %}
              {% if category in ['success', 'ok'] %}{% set bs = 'success' %}{% endif %}
              {% if category in ['danger', 'error'] %}{% set bs = 'danger' %}{% endif %}
              {% if category in ['warning'] %}{% set bs = 'warning' %}{% endif %}

              <div class="alert alert-{{ bs }} mb-2" role="alert">
                {{ message }}
              </div>
            {% endfor %}
        {% if not is_auth_page %}
            </div>
        {% endif %}
          </div>
      {% endif %}
    {% endwith %}

    {% if is_auth_page %}
      <div class="layout-shell"><div class="auth-wrap">
    {% else %}
      <div class="layout-3col">
        <aside class="col-left">{% include 'components/_sidebar_left.html' %}</aside>
        <section class="col-main">
    {% endif %}

    {% block content %}{% endblock %}

    {% if is_auth_page %}
      </div></div>
    {% else %}
        </section>
        <aside class="col-right">{% include 'components/_sidebar_right.html' %}</aside>
      </div>
    {% endif %}
  </main>

  <div class="scroll-controls" aria-label="Быстрая прокрутка">
    <button class="scroll-controls__btn" type="button" data-scroll="top" aria-label="Вверх">
      ↑
    </button>
    <button class="scroll-controls__btn" type="button" data-scroll="bottom" aria-label="Вниз">
      ↓
    </button>
  </div>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>

  <script>
    // Thread expand/collapse toggle - event delegation
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.js-toggle-post');
      if (!btn) return;
      
      e.preventDefault();
      e.stopPropagation();
      
      const id = btn.dataset.target;
      if (!id) {
        console.warn('No data-target on toggle', btn);
        return;
      }
      
      const container = document.getElementById(id);
      if (!container) {
        console.warn('Target not found', id);
        return;
      }

      const restSpan = container.querySelector('.thread-text-rest');
      if (!restSpan) return;

      const isExpanded = container.classList.contains('is-expanded');

      // Clean up any existing transitionend handler and timeout
      if (container._transitionEndHandler) {
        container.removeEventListener('transitionend', container._transitionEndHandler);
        container._transitionEndHandler = null;
      }
      if (container._transitionTimeout) {
        clearTimeout(container._transitionTimeout);
        container._transitionTimeout = null;
      }

      // Get computed transition duration for fallback timer
      const computedStyle = window.getComputedStyle(container);
      const transitionDuration = parseFloat(computedStyle.transitionDuration) || 0.22; // fallback to 220ms
      const fallbackDelay = Math.ceil(transitionDuration * 1000) + 50; // add 50ms buffer

      if (!isExpanded) {
        // EXPANDING
        // Step 1: Set explicit current height
        const currentHeight = container.offsetHeight;
        container.style.height = currentHeight + 'px';

        // Step 2: Add is-expanded class (CSS reveals rest/hides ellipsis)
        container.classList.add('is-expanded');
        btn.classList.add('is-expanded');
        btn.setAttribute('aria-expanded', 'true');

        // Step 3: On next rAF, measure scrollHeight and animate to target
        requestAnimationFrame(() => {
          // Force reflow to ensure CSS changes are applied
          void container.offsetHeight;
          
          const fullHeight = container.scrollHeight;
          container.style.height = fullHeight + 'px';

          // Step 4: On transitionend, clear style.height
          const onTransitionEnd = (evt) => {
            if (evt.propertyName !== 'height') return;
            container.removeEventListener('transitionend', onTransitionEnd);
            container.style.height = '';
            container._transitionEndHandler = null;
            if (container._transitionTimeout) {
              clearTimeout(container._transitionTimeout);
              container._transitionTimeout = null;
            }
          };

          container._transitionEndHandler = onTransitionEnd;
          container.addEventListener('transitionend', onTransitionEnd, { once: true });

          // Fallback timer
          container._transitionTimeout = setTimeout(() => {
            container.style.height = '';
            if (container._transitionEndHandler === onTransitionEnd) {
              container.removeEventListener('transitionend', onTransitionEnd);
              container._transitionEndHandler = null;
            }
            container._transitionTimeout = null;
          }, fallbackDelay);
        });
      } else {
        // COLLAPSING
        // Step 1: Set explicit current full height
        const currentHeight = container.scrollHeight;
        container.style.height = currentHeight + 'px';

        // Step 2: Remove is-expanded class (CSS hides rest/shows ellipsis)
        container.classList.remove('is-expanded');
        btn.classList.remove('is-expanded');
        btn.setAttribute('aria-expanded', 'false');

        // Step 3: On next rAF, measure collapsed scrollHeight and animate to collapsed height
        requestAnimationFrame(() => {
          // Force reflow to ensure CSS changes are applied
          void container.offsetHeight;
          
          const collapsedHeight = container.scrollHeight;

          // If heights are equal, just clear height immediately
          if (collapsedHeight === currentHeight) {
            container.style.height = '';
          } else {
            container.style.height = collapsedHeight + 'px';

            // Step 4: On transitionend, clear style.height
            const onTransitionEnd = (evt) => {
              if (evt.propertyName !== 'height') return;
              container.removeEventListener('transitionend', onTransitionEnd);
              container.style.height = '';
              container._transitionEndHandler = null;
              if (container._transitionTimeout) {
                clearTimeout(container._transitionTimeout);
                container._transitionTimeout = null;
              }
            };

            container._transitionEndHandler = onTransitionEnd;
            container.addEventListener('transitionend', onTransitionEnd, { once: true });

            // Fallback timer
            container._transitionTimeout = setTimeout(() => {
              container.style.height = '';
              if (container._transitionEndHandler === onTransitionEnd) {
                container.removeEventListener('transitionend', onTransitionEnd);
                container._transitionEndHandler = null;
              }
              container._transitionTimeout = null;
            }, fallbackDelay);
          }
        });
      }
    });

    // Initialize expandables on page load
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.js-expandable').forEach((container) => {
        const restSpan = container.querySelector('.thread-text-rest');
        if (!restSpan) return;

        // Ensure collapsed state (CSS handles visibility via is-expanded class)
        container.classList.remove('is-expanded');
        // Don't set inline height - let container size naturally to preview content
        container.style.height = '';
      });

      // Scroll controls
      function scrollToTop() {
        smoothScrollTo(0, 800);
      }

      function scrollToBottom() {
        smoothScrollTo(document.body.scrollHeight, 800);
      }

      function smoothScrollTo(target, duration) {
        const start = window.pageYOffset || document.documentElement.scrollTop;
        const distance = target - start;
        let startTime = null;

        function animation(currentTime) {
          if (startTime === null) startTime = currentTime;
          const timeElapsed = currentTime - startTime;
          const progress = Math.min(timeElapsed / duration, 1);
          
          // Easing function for smooth acceleration/deceleration
          const ease = progress < 0.5 
            ? 2 * progress * progress 
            : 1 - Math.pow(-2 * progress + 2, 2) / 2;

          window.scrollTo(0, start + distance * ease);

          if (timeElapsed < duration) {
            requestAnimationFrame(animation);
          } else {
            window.scrollTo(0, target);
          }
        }

        requestAnimationFrame(animation);
      }

      // Support data-scroll attributes (existing)
      document.querySelectorAll("[data-scroll]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const direction = btn.getAttribute("data-scroll");
          if (direction === "bottom") {
            scrollToBottom();
          } else {
            scrollToTop();
          }
        });
      });

      // Support .scroll-to-top and .scroll-to-bottom classes
      document.querySelectorAll(".scroll-to-top").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          scrollToTop();
        });
      });

      document.querySelectorAll(".scroll-to-bottom").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          scrollToBottom();
        });
      });
    });
  </script>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 500, easing: "ease-out-cubic", once: true, offset: 60 });
  </script>

  <script>
    // Image preview functionality for file inputs
    (function() {
      function setupImagePreview(input, previewContainer) {
        if (!input || !previewContainer) return;

        const previewImg = previewContainer.querySelector('.image-preview');
        const removeBtn = previewContainer.querySelector('.image-preview-remove');

        function showPreview(file) {
          if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
              previewImg.src = e.target.result;
              previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
          }
        }

        function hidePreview() {
          previewContainer.style.display = 'none';
          previewImg.src = '';
          input.value = '';
        }

        input.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            showPreview(file);
          } else {
            hidePreview();
          }
        });

        if (removeBtn) {
          removeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            hidePreview();
          });
        }
      }

      // Setup previews for all image inputs when DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        // Thread creation form
        const threadInput = document.getElementById('thread-image-input');
        const threadPreviewContainer = document.getElementById('thread-image-preview');
        const threadAttachBtn = document.getElementById('thread-attach-btn');
        const threadFileNameEl = document.getElementById('thread-file-name');
        
        if (threadInput && threadPreviewContainer && threadAttachBtn && threadFileNameEl) {
          const threadPreviewImg = threadPreviewContainer.querySelector('img');
          const threadRemoveBtn = threadPreviewContainer.querySelector('.image-preview-remove');
          
          if (threadPreviewImg && threadRemoveBtn) {
            let threadObjectURL = null;
            
            threadInput.addEventListener('change', () => {
              const file = threadInput.files && threadInput.files[0];
              if (!file) return;
              
              if (threadObjectURL) {
                URL.revokeObjectURL(threadObjectURL);
              }
              
              threadObjectURL = URL.createObjectURL(file);
              threadPreviewImg.src = threadObjectURL;
              threadPreviewContainer.classList.remove('d-none');
              
              threadFileNameEl.textContent = file.name;
              threadAttachBtn.classList.add('d-none');
            });
            
            threadRemoveBtn.addEventListener('click', () => {
              if (threadObjectURL) {
                URL.revokeObjectURL(threadObjectURL);
                threadObjectURL = null;
              }
              
              threadInput.value = '';
              threadPreviewImg.src = '';
              threadPreviewContainer.classList.add('d-none');
              threadAttachBtn.classList.remove('d-none');
              threadFileNameEl.textContent = '';
            });
          }
        }

        // Comment form (handled in thread.html)
        
        // Update form
        const updateInput = document.querySelector('.update-image-input');
        if (updateInput) {
          const updateContainer = updateInput.closest('form')?.querySelector('.image-preview-container');
          if (updateContainer) {
            setupImagePreview(updateInput, updateContainer);
          }
        }

        // Avatar form
        const avatarInput = document.getElementById('avatar-image-input');
        const avatarPreviewContainer = document.getElementById('avatar-image-preview');
        const avatarAttachBtn = document.getElementById('avatar-attach-btn');
        const avatarFileNameEl = document.getElementById('avatar-file-name');
        
        if (avatarInput && avatarPreviewContainer && avatarAttachBtn && avatarFileNameEl) {
          const avatarPreviewImg = avatarPreviewContainer.querySelector('img');
          const avatarRemoveBtn = avatarPreviewContainer.querySelector('.image-preview-remove');
          
          if (avatarPreviewImg && avatarRemoveBtn) {
            let avatarObjectURL = null;
            
            avatarInput.addEventListener('change', () => {
              const file = avatarInput.files && avatarInput.files[0];
              if (!file) return;
              
              if (avatarObjectURL) {
                URL.revokeObjectURL(avatarObjectURL);
              }
              
              avatarObjectURL = URL.createObjectURL(file);
              avatarPreviewImg.src = avatarObjectURL;
              avatarPreviewContainer.classList.remove('d-none');
              
              avatarFileNameEl.textContent = file.name;
              avatarAttachBtn.classList.add('d-none');
            });
            
            avatarRemoveBtn.addEventListener('click', () => {
              if (avatarObjectURL) {
                URL.revokeObjectURL(avatarObjectURL);
                avatarObjectURL = null;
              }
              
              avatarInput.value = '';
              avatarPreviewImg.src = '';
              avatarPreviewContainer.classList.add('d-none');
              avatarAttachBtn.classList.remove('d-none');
              avatarFileNameEl.textContent = '';
            });
          }
        }
      });
    })();
  </script>

  <script>
    // Auto-growing textareas
    (function() {
      function adjustTextareaHeight(textarea) {
        if (!textarea) return;
        
        // Reset height to auto to get accurate scrollHeight
        textarea.style.height = 'auto';
        
        // Get computed max-height from CSS
        const computedStyle = window.getComputedStyle(textarea);
        const maxHeight = parseFloat(computedStyle.maxHeight) || 400;
        const scrollHeight = textarea.scrollHeight;
        
        // Use requestAnimationFrame for smooth updates
        requestAnimationFrame(() => {
          if (scrollHeight > maxHeight) {
            // Content exceeds max-height, enable scrolling
            textarea.style.height = maxHeight + 'px';
            textarea.classList.add('js-autogrow--scroll');
          } else {
            // Content fits, grow to content height
            textarea.style.height = scrollHeight + 'px';
            textarea.classList.remove('js-autogrow--scroll');
          }
        });
      }
      
      function setupAutoGrow(textarea) {
        if (!textarea) return;
        
        // Initial adjustment
        adjustTextareaHeight(textarea);
        
        // Adjust on input
        textarea.addEventListener('input', function() {
          adjustTextareaHeight(this);
        });
        
        // Adjust on window resize (in case container width changes)
        window.addEventListener('resize', function() {
          adjustTextareaHeight(textarea);
        });
      }
      
      // Initialize on DOM ready
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.js-autogrow').forEach(setupAutoGrow);
      });
      
      // Also handle dynamically added textareas (e.g., via AJAX)
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === 1) { // Element node
              if (node.classList && node.classList.contains('js-autogrow')) {
                setupAutoGrow(node);
              }
              // Check for nested textareas
              const textareas = node.querySelectorAll && node.querySelectorAll('.js-autogrow');
              if (textareas) {
                textareas.forEach(setupAutoGrow);
              }
            }
          });
        });
      });
      
      // Start observing after DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        observer.observe(document.body, {
          childList: true,
          subtree: true
        });
      });
    })();
  </script>

  <script>
    // Vote (thread / comment) — delegation + anti-double
(function() {
  const pending = new Set();

  function key(type, id) { return type + ":" + id; }

  document.addEventListener('DOMContentLoaded', function() {
    document.body.addEventListener('click', function(e) {
      var btn = e.target.closest('.js-vote-thread');
      if (btn) {
        e.preventDefault();
        e.stopPropagation();

        var voteEl = btn.closest('.vote');
        if (!voteEl) return;

        var threadId = voteEl.getAttribute('data-thread-id');
        var value = parseInt(btn.getAttribute('data-value'), 10);
        if (!threadId || (value !== 1 && value !== -1)) return;

        const k = key("t", threadId);
        if (pending.has(k)) return;
        pending.add(k);

        var scoreEl = voteEl.querySelector('.js-thread-score');
        var url = '/thread/' + threadId + '/vote';

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify({ value: value }),
          credentials: 'same-origin'
        })
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            if (scoreEl) scoreEl.textContent = data.score;
            var likeBtn = voteEl.querySelector('.js-vote-thread[data-value="1"]');
            var dislikeBtn = voteEl.querySelector('.js-vote-thread[data-value="-1"]');
            if (likeBtn) likeBtn.classList.remove('vote-btn-active', 'vote-btn-active--dislike');
            if (dislikeBtn) dislikeBtn.classList.remove('vote-btn-active', 'vote-btn-active--dislike');
            if (data.my_vote === 1 && likeBtn) likeBtn.classList.add('vote-btn-active');
            if (data.my_vote === -1 && dislikeBtn) dislikeBtn.classList.add('vote-btn-active--dislike');
          }
        })
        .finally(() => pending.delete(k));

        return;
      }

      btn = e.target.closest('.js-vote-comment');
      if (btn) {
        e.preventDefault();
        e.stopPropagation();

        var voteEl = btn.closest('.vote');
        if (!voteEl) return;

        var commentId = voteEl.getAttribute('data-comment-id');
        var threadId = voteEl.getAttribute('data-thread-id');
        var value = parseInt(btn.getAttribute('data-value'), 10);
        if (!commentId || !threadId || (value !== 1 && value !== -1)) return;

        const k = key("c", commentId);
        if (pending.has(k)) return;
        pending.add(k);

        var scoreEl = voteEl.querySelector('.js-comment-score');
        var url = '/thread/' + threadId + '/comment/' + commentId + '/vote';

        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify({ value: value }),
          credentials: 'same-origin'
        })
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            if (scoreEl) scoreEl.textContent = data.score;
            var likeBtn = voteEl.querySelector('.js-vote-comment[data-value="1"]');
            var dislikeBtn = voteEl.querySelector('.js-vote-comment[data-value="-1"]');
            if (likeBtn) likeBtn.classList.remove('vote-btn-active', 'vote-btn-active--dislike');
            if (dislikeBtn) dislikeBtn.classList.remove('vote-btn-active', 'vote-btn-active--dislike');
            if (data.my_vote === 1 && likeBtn) likeBtn.classList.add('vote-btn-active');
            if (data.my_vote === -1 && dislikeBtn) dislikeBtn.classList.add('vote-btn-active--dislike');
          }
        })
        .finally(() => pending.delete(k));
      }
    });
  });
})();
  </script>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  (function () {
    window.SWAMP_SOCKET = io({
      transports: ["websocket", "polling"],
      timeout: 8000,
      reconnectionAttempts: 5
    });
  })();
</script>
{% block scripts %}{% endblock %}
</body>
</html>